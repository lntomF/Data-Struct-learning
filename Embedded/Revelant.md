# 嵌入式名词相关学习

## 中断进阶学习

### 学习路径

1. **了解什么是中断**  
   中断是在除 CPU 上的其他外设所发生的使 CPU 异常的。CPU 外部（比如各种片上总线，AHB、APB 等）促使 CPU 内部产生异常的，叫做中断。

2. **了解什么是异常**  
   对于 Cortex-M4 来说，CPU 内部打断当前程序执行流的（比如算数异常，除 0），叫异常。

   **同步异常和异步异常：**
   - 同步异常是 CPU 直接接受异常直接反映到 OS 上
   - 异步异常是外设接受异常后通过一段时间反映到 CPU 上然后在反映到 OS 上

3. **了解什么是内核、总线及外设**
   - **内核** -> CPU
   - **总线** -> 外设和 CPU 之间的桥梁（数据总线、指令总线、系统总线......）
   - **外设** -> 片上外设（I2C、SPI、UART......）

4. **什么是 NVIC 内核外设**  
   NVIC 内核外设 -> CPU 内部的专用外设，用于控制中断系统的总指挥。

5. **什么是中断向量表 2 次幂对齐**  
   中断向量表的 2 次幂对齐 -> 中断向量表对偏移量大小的要求。必须是向上圆整，否则会出错。

   **偏移量的计算方法：**（内部异常 + 外部中断个数）× 4 就是异常和中断所占的字节数，在字节数的上方寻找离字节数最近的 2 的幂数。

6. **什么是软中断**  
   软中断 -> 是软件触发的中断机制。软中断在项目开发中可以用来异步事件处理、任务间通信、系统调用、错误处理和测试。

   **例子：软件定时器**  
   软件定时器：在一个硬件定时器定时一个 1ms，然后用软件进行相关的操作 -> 在 20 个 1ms 中操作，在 30 个 1ms 中操作......

7. **了解什么是中断悬起/中断的延迟**  
   **单一一次中断的中断处理过程：** 中断产生后通过总线发送中断请求到 NVIC 中，中断悬起后中断请求结束，然后 CPU 会从线程模式转移到 Handler 模式，然后中断悬起会被解悬，然后在进行中断处理函数。

   **中断的延迟** -> 从中断触发（请求开始）到 CPU 开始执行中断服务程序（ISR）的时间，称为中断延迟。

   > **线程模式 vs. Handler 模式：**
   > - **线程模式**：运行普通代码（如 main 函数）
   > - **Handler 模式**：运行中断服务程序（ISR），具有更高权限（可访问特殊寄存器）

8. **了解产生持续中断的中断处理过程**  
   在连续中断场景下，若新中断的优先级高于当前 ISR，CPU 会立即抢占当前 Handler 模式，执行新中断（嵌套中断）；若优先级相同或更低，则需等待当前 ISR 完成。电平触发中断可能因信号未清除而重复触发，无需等待前一个 ISR 完全退出。

   **_面试常问_**

9. **产生多次中断脉冲的中断处理过程（位于中断悬起过程中）**  
   在连续中断的场景下，若外部有持续的中断请求，则该中断在悬起过程中只会执行最初接触的请求，之后的中断请求就会被丢弃。

   ![中断悬起过程示意图](/Embedded/photo/产生多次中断脉冲的中断处理过程（位于中断悬起过程中）.png)

10. **产生多次中断脉冲的中断处理过程（位于中断悬起过程之外）**  
    ![中断悬起过程之外示意图](/Embedded/photo/产生多次中断脉冲的中断处理过程（位于中断悬起过程之外）.png)

11. **寄存器映射**  
    处在内核的地址（对应一些外设的地址）在通过一些总线转移到外设寄存器上的地址（Code 一般保存在片内 flash 中）

12. **栈回溯原理及相关寄存器的代表**
   栈回溯（Stack Backtrace）是指通过分析当前程序的调用栈（Call Stack），追踪函数调用的嵌套关系，从而还原程序的执行路径。

   >**在异常处理的过程中有两个相关的寄存器：**
   >1.在异常时压栈后**LR**崩溃前的返回地址（可能指向调用者）。
   >2.**PC**是：崩溃时的指令地址。
   ![异常处理示意图](/Embedded/photo/异常处理的流程.png)
